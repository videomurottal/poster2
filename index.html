<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>

<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#fefcf8">
  
<link rel="icon" href="./icon-192.png" type="image/png" sizes="192x192">
<link rel="apple-touch-icon" href="https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/iconposter.png">

  
  <meta charset="UTF-8">
  <title>Poster Quran</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <style>
    
    body {
  background: #fefcf8;
  padding: 1em;
  font-family: sans-serif;
  direction: rtl;
  margin: 0;
}

h2 {
  text-align: center;
  font-size: clamp(0.9rem, 2.5vw, 1.5rem);
  margin-bottom: 1rem;
}

    #installPWAButton {
  background: linear-gradient(to right, #06beb6, #48b1bf);
  color: white;
}

#installPWAButton:hover {
  background: linear-gradient(to right, #0aa1a4, #3793a9);
}

.modal-content {
  direction: ltr; /* ✅ force kiri ke kanan */
  text-align: left; /* ✅ teks rata kiri */
}

    
#applyPexelsBtn {
  width: 100%;
  padding: 12px 12px; /* ⬅️ dari 12px 0 ke 12px 12px biar proporsional */
  background-color: #38bdf8;
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 16px;
  cursor: pointer;
  box-sizing: border-box; /* ⬅️ supaya padding tidak merusak lebar */
}

#applyPexelsBtn:hover {
  background-color: #0ea5e9;
}


#pexelsKeyword {
  width: 100%;
  padding: 12px 12px; /* ⬅️ diperbesar supaya lebih nyaman diketik */
  font-size: 16px;
  border: 1px solid #ccc;
  border-radius: 8px;
  margin-bottom: 12px; /* ⬅️ sedikit lebih lega jarak bawah */
  box-sizing: border-box;
}


.pexels-close {
  position: absolute;
  top: 2px;         
  right: 22px;
  border-radius: 0; /* hapus bulat */
  background: none; /* ✅ hapus background biru */
  color: #fff;   /* merah untuk ❌ */
  font-size: 1.2rem;
  border: none;     
  width: auto;      /* biarkan auto */
  height: auto;     
  line-height: normal;
  text-align: center;
  cursor: pointer;
}

.modal-overlay {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0, 0, 0, 0.6);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 10000;
}

.modal-content {
  background: #fff;
  border-radius: 12px;
  padding: 20px;
  width: 90%;
  max-width: 500px;
  box-shadow: 0 8px 16px rgba(0,0,0,0.25);
  animation: fadeIn 0.3s ease-out;
  position: relative; /* ⬅️ supaya .pexels-close tetap di dalam modal */
}

@keyframes fadeIn {
  from { opacity: 0; transform: scale(0.9); }
  to { opacity: 1; transform: scale(1); }
}




    

#pages::before {
  content: "";
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  background-image: var(--bg-image);
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  z-index: 0;
  opacity: var(--bg-opacity, 1);
  pointer-events: none;
  transition: opacity 0.3s ease;
}

    #pages > *:not(.brand-watermark) {
  position: relative;
  z-index: 1;
}



    


#kataInput, #searchInput, #translationSelect, #mulaiSearchBtn {
  width: 100%;
  max-width: 420px; /* Biar di desktop rapi */
  padding: 12px 16px;
  font-size: 1.1rem;
  border: 1px solid #ccc;
  border-radius: 6px;
  margin: 8px auto;
  display: block;
  box-sizing: border-box;
}

#mulaiSearchBtn {
  background-color: #4db8ff;
  color: white;
  border: none;
  cursor: pointer;
}

#mulaiSearchBtn:hover {
  background-color: #1a90ff;
}

@media (max-width: 480px) {
  #kataInput, #searchInput, #translationSelect, #mulaiSearchBtn {
    max-width: 90%; /* Supaya pas di layar kecil */
  }
}

 /* Modal Overlay */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  z-index: 9999;
  width: 100vw;
  height: 100vh;
  display: none;
  align-items: center;
  justify-content: center;
  background: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(2px);
}

/* Modal Box */
.modal-content {
  background: #fff;
  width: 90%;
  max-width: 420px;
  padding: 1.5em;
  border-radius: 10px;
  position: relative;
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
}
    .search-close {
  position: absolute;
  top: 2px;         
  right: 22px;
  border-radius: 0; /* hapus bulat */
  background: none; /* ✅ hapus background biru */
  color: #fff;   /* merah untuk ❌ */
  font-size: 1.2rem;
  border: none;     
  width: auto;      /* biarkan auto */
  height: auto;     
  line-height: normal;
  text-align: center;
  cursor: pointer;
}


/* Input & Button */
#searchInput, #startSearchBtn {
  width: 100%;
  margin-top: 10px;
  padding: 0.7em;
  font-size: 1rem;
  border-radius: 6px;
  border: 1px solid #ccc;
  box-sizing: border-box;
}

#startSearchBtn {
  background: #007bff;
  color: white;
  border: none;
  cursor: pointer;
  margin-top: 12px;
}

#startSearchBtn:hover {
  background: #0056b3;
}

/* Hasil */
#searchResults {
  margin-top: 1em;
  max-height: 250px;
  overflow-y: auto;
}
#searchResults p {
  background: #f0f0f0;
  padding: 0.6em;
  margin-bottom: 0.5em;
  border-radius: 6px;
}
#searchResults button {
  margin-top: 0.5em;
  padding: 0.3em 0.6em;
  font-size: 0.9rem;
  background: #28a745;
  border: none;
  border-radius: 4px;
  color: white;
  cursor: pointer;
}
#searchResults button:hover {
  background: #1e7e34;
}
















    #pages {
  background-color: #000000; /* default warna latar */
}

    input[type="color"] {
  width: 100%;           /* agar selebar elemen lain */
  height: 2.8em;         /* ⬅️ ini membuatnya setara tinggi tombol/dropdown */
  border: 1px solid #ccc;
  border-radius: 6px;
  padding: 0;            /* hilangkan padding default */
  box-sizing: border-box;
  background: none;
  cursor: pointer;
}


    .translation[contenteditable="true"] {
  cursor: text;
}

#pages {
  /* ... (sudah ada background properties) */
  filter: contrast(1); /* Default */
  transition: filter 0.3s ease;
}
    
input[type="file"],
input[type="url"],
select,
button {
  font-size: clamp(1rem, 3vw, 1.2rem);
  padding: 0.5em;
  border: 1px solid #ccc;
  border-radius: 6px;
  width: 100%;
  box-sizing: border-box;
}

button {
  background-color: #4cafef;
  color: #fff;
  cursor: pointer;
  transition: background 0.3s ease;
}

button:hover {
  background-color: #007acc;
}

#pages {
  width: 100%;
  max-width: 540px;
  aspect-ratio: 1 / 1;
  margin: 2em auto;
  position: relative;
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
}

.controls {
  direction: ltr;
  max-width: 800px;
  margin: 0 auto;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
  gap: 0.8em;
  justify-content: center;
  align-items: center;
  padding: 0.5em;
}

.controls label {
  font-size: clamp(0.85rem, 2.5vw, 1rem);
  display: flex;
  flex-direction: column;
}

/* Quran V1 */
.quran-v1 {
  font-size: clamp(1.8em, 5vw, 2.5em);
  line-height: 1.5;
  word-spacing: 0.1em;
  text-align: center;
  user-select: text;
  margin: 2em auto;
  color: #ffffff;
  opacity: 0;
  transition: opacity 0.3s ease;
  display: none;
  max-width: 80%;
  overflow-wrap: break-word;
}

/* Quran V2 */
.quran-v2 {
  font-size: clamp(1.8em, 5vw, 2.5em);
  line-height: 1.7;
  word-spacing: 0.0em;
  text-align: center;
  user-select: text;
  margin: 2em auto;
  color: #ffffff;
  opacity: 0;
  transition: opacity 0.3s ease;
  display: none;
  max-width: 80%;
  overflow-wrap: break-word;
}

.word {
  display: inline-block;
  margin: 0;
  cursor: default;
}

/* Terjemahan */
.translation {
  font-family: sans-serif;
  font-size: clamp(1rem, 3vw, 1.2rem);
  color: #ffffff;
  direction: ltr;
  text-align: center;
  line-height: 1.4;
  word-spacing: 0.2em;
  margin-top: 0.5em;
  padding: 0 0.5em;
}
    .surah-info {
  font-size: 0.4em;
  font-family: sans-serif;
  color: #ffffff;
  margin-top: 0.5em;
  text-align: center;
  direction: ltr;
}

.brand-watermark {
  font-size: 0.8em;
  font-family: sans-serif;
  color: #999;
  position: absolute;     /* ⬅️ Supaya tidak mendorong kotak */
  bottom: 0.5em;           /* ⬅️ Turunkan ke bawah */
  left: 50%;              
  transform: translateX(-50%); /* ⬅️ Tengahkan secara horizontal */
  text-align: center;
  font-style: italic;
  direction: ltr;
  user-select: none;
}
    

    .button-wrapper {
  display: flex;
  align-items: flex-end;
}

@media (max-width: 600px) {
  .controls {
    grid-template-columns: repeat(2, 1fr);
  }
}
    
  </style>
</head>
<body>

  

<h2>Poster Quran - Terjemah & Watermark Bisa Diedit</h2>
  
<div class="controls">
  <!-- Baris 1: Surah & Ayat -->
  <label><select id="surahSelect"></select>
  </label>
  <label><select id="ayahSelect"></select>
  </label>

  <!-- Baris 2: Dari Kata & Sampai Kata -->
  <label><select id="wordStart"></select>
  </label>
  <label><select id="wordEnd"></select>
  </label>

  <!-- Baris 3: Terjemahan & Tombol Link & Quran V1/V2 -->
  <label>
  <select id="wordTranslationId">
  <!-- Per-Kata (Quran.com) -->
    <option value="33">Perkata Indonesian Affairs</option>
    <option value="20">Perkata English Saheeh</option>
    <option value="ayah_quran_text">Saudi Arabia - Only Text</option>
    <option value="ayah_indonesian_complex">Indonesia – Indonesian (Complex)</option>

   <!-- Per-Ayat (QuranEnc.com), sorted by country name -->
<option value="ayah_pashto_rwwad">Afghanistan – Pashto (Rwwad)</option>
<option value="ayah_albanian_nahi">Albania – Albanian (Nahi)</option>
<option value="ayah_azeri_musayev">Azerbaijan – Azeri (Musayev)</option>
<option value="ayah_bosnian_rwwad">Bosnia – Bosnian (Rwwad)</option>
<option value="ayah_moore_rwwad">Burkina Faso – Moore (Rwwad)</option>
<option value="ayah_ikirundi_gehiti">Burundi – Kirundi (Gehiti)</option>
<option value="ayah_khmer_rwwad">Cambodia – Khmer (Rwwad)</option>
<option value="ayah_chinese_makin">China – Chinese (Makin)</option>
<option value="ayah_lingala_zakaria">Congo – Lingala (Zakaria)</option>
<option value="ayah_croatian_rwwad">Croatia – Croatian (Rwwad)</option>
<option value="ayah_af ar_hamza">Djibouti – Afar (Hamza)</option>
<option value="ayah_amharic_zain">Ethiopia – Amharic (Zain)</option>
<option value="ayah_oromo_ababor">Ethiopia – Oromo (Ababor)</option>
<option value="ayah_french_rashid">France – French (Rashid)</option>
<option value="ayah_german_bubenheim">Germany – German (Bubenheim)</option>
<option value="ayah_asante_harun">Ghana – Asante (Harun)</option>
<option value="ayah_gujarati_omari">India – Gujarati (Omari)</option>
<option value="ayah_hindi_omari">India – Hindi (Omari)</option>
<option value="ayah_kannada_hamza">India – Kannada (Hamza)</option>
<option value="ayah_malayalam_kunhi">India – Malayalam (Kunhi)</option>
<option value="ayah_tamil_baqavi">India – Tamil (Baqavi)</option>
<option value="ayah_telugu_muhammad">India – Telugu (Muhammad)</option>
<option value="ayah_kurdish_bamoki">Iraq – Kurdish (Bamoki)</option>
<option value="ayah_persian_ih">Iran – Persian (IH)</option>
<option value="ayah_japanese_saeedsato">Japan – Japanese (Saeed Sato)</option>
<option value="ayah_kyrgyz_hakimov">Kyrgyzstan – Kyrgyz (Hakimov)</option>
<option value="ayah_lithuanian_rwwad">Lithuania – Lithuanian (Rwwad)</option>
<option value="ayah_ankobambara_dayyan">Mali – Bambara (Dayyan)</option>
<option value="ayah_dutch_center">Netherlands – Dutch (Center)</option>
<option value="ayah_hausa_gummi">Nigeria – Hausa (Gummi)</option>
<option value="ayah_yoruba_mikail">Nigeria – Yoruba (Mikail)</option>
<option value="ayah_macedonian_group">North Macedonia – Macedonian (Group)</option>
<option value="ayah_punjabi_arif">Pakistan – Punjabi (Arif)</option>
<option value="ayah_bisayan_rwwad">Philippines – Bisayan (Rwwad)</option>
<option value="ayah_tagalog_rwwad">Philippines – Tagalog (Rwwad)</option>
<option value="ayah_portuguese_nasr">Portugal/Brazil – Portuguese (Nasr)</option>
<option value="ayah_romanian_project">Romania – Romanian (Project)</option>
<option value="ayah_kinyarwanda_assoc">Rwanda – Kinyarwanda (Assoc)</option>
<option value="ayah_serbian_rwwad">Serbia – Serbian (Rwwad)</option>
<option value="ayah_sinhalese_mahir">Sri Lanka – Sinhalese (Mahir)</option>
<option value="ayah_tamil_omar">Sri Lanka/India – Tamil (Omar)</option>
<option value="ayah_somali_yacob">Somalia – Somali (Yacob)</option>
<option value="ayah_spanish_montada_eu">Spain – Spanish (Montada EU)</option>
<option value="ayah_spanish_montada_latin">Latin America – Spanish (Montada Latin)</option>
<option value="ayah_swahili_barawani">Tanzania – Swahili (Barawani)</option>
<option value="ayah_tajik_arifi">Tajikistan – Tajik (Arifi)</option>
<option value="ayah_turkish_rwwad">Turkey – Turkish (Rwwad)</option>
<option value="ayah_urdu_junagarhi">India/Pakistan – Urdu (Junagarhi)</option>
<option value="ayah_english_rwwad">USA – English (Rwwad)</option>
<option value="ayah_uyghur_saleh">Uyghur (Saleh)</option>
<option value="ayah_uzbek_rwwad">Uzbekistan – Uzbek (Rwwad)</option>
<option value="ayah_vietnamese_rwwad">Vietnam – Vietnamese (Rwwad)</option>
  </select>
</label>

  
  

<!-- 🔍 Tombol Search -->
<div class="button-wrapper">
  <button id="customLinkButton">Cari Judul</button>
</div>

<!-- 📦 Modal Pencarian -->
<div id="searchModal" class="modal-overlay" style="display: none;">
  <div class="modal-content">
    <button class="search-close">❌</button>
    <h3>Pencarian Kata</h3>

    <!-- 🌐 Dropdown Pilihan Terjemah -->
    <label for="translationSelect">Pilih Terjemahan:</label>
    <select id="translationSelect" style="width: 100%; margin-bottom: 10px;">
      <option value="indonesian_complex">🇮🇩 Indonesian</option>
      <option value="quran_text">🇸🇦 Saudi Arabia – Arabic</option>
      <option value="english_rwwad">🇬🇧 English</option>
      <option value="pashto_rwwad">🇦🇫 Afghanistan – Pashto (Rwwad)</option>
      <option value="albanian_nahi">🇦🇱 Albania – Albanian (Nahi)</option>
      <option value="azeri_musayev">🇦🇿 Azerbaijan – Azeri (Musayev)</option>
      <option value="bosnian_rwwad">🇧🇦 Bosnia – Bosnian (Rwwad)</option>
      <option value="moore_rwwad">🇧🇫 Burkina Faso – Moore (Rwwad)</option>
      <option value="ikirundi_gehiti">🇧🇮 Burundi – Kirundi (Gehiti)</option>
      <option value="khmer_rwwad">🇰🇭 Cambodia – Khmer (Rwwad)</option>
      <option value="chinese_makin">🇨🇳 China – Chinese (Makin)</option>
      <option value="lingala_zakaria">🇨🇩 Congo – Lingala (Zakaria)</option>
      <option value="croatian_rwwad">🇭🇷 Croatia – Croatian (Rwwad)</option>
      <option value="af_ar_hamza">🇩🇯 Djibouti – Afar (Hamza)</option>
      <option value="amharic_zain">🇪🇹 Ethiopia – Amharic (Zain)</option>
      <option value="oromo_ababor">🇪🇹 Ethiopia – Oromo (Ababor)</option>
      <option value="french_rashid">🇫🇷 French</option>
      <option value="german_bubenheim">🇩🇪 Germany – German (Bubenheim)</option>
      <option value="asante_harun">🇬🇭 Ghana – Asante (Harun)</option>
      <option value="gujarati_omari">🇮🇳 India – Gujarati (Omari)</option>
      <option value="hindi_omari">🇮🇳 India – Hindi (Omari)</option>
      <option value="kannada_hamza">🇮🇳 India – Kannada (Hamza)</option>
      <option value="malayalam_kunhi">🇮🇳 India – Malayalam (Kunhi)</option>
      <option value="tamil_baqavi">🇮🇳 India – Tamil (Baqavi)</option>
      <option value="telugu_muhammad">🇮🇳 India – Telugu (Muhammad)</option>
      <option value="kurdish_bamoki">🇮🇶 Iraq – Kurdish (Bamoki)</option>
      <option value="persian_ih">🇮🇷 Iran – Persian (IH)</option>
      <option value="japanese_saeedsato">🇯🇵 Japan – Japanese (Saeed Sato)</option>
      <option value="kyrgyz_hakimov">🇰🇬 Kyrgyzstan – Kyrgyz (Hakimov)</option>
      <option value="lithuanian_rwwad">🇱🇹 Lithuania – Lithuanian (Rwwad)</option>
      <option value="ankobambara_dayyan">🇲🇱 Mali – Bambara (Dayyan)</option>
      <option value="dutch_center">🇳🇱 Netherlands – Dutch (Center)</option>
      <option value="hausa_gummi">🇳🇬 Nigeria – Hausa (Gummi)</option>
      <option value="yoruba_mikail">🇳🇬 Nigeria – Yoruba (Mikail)</option>
      <option value="macedonian_group">🇲🇰 North Macedonia – Macedonian (Group)</option>
      <option value="punjabi_arif">🇵🇰 Pakistan – Punjabi (Arif)</option>
      <option value="bisayan_rwwad">🇵🇭 Philippines – Bisayan (Rwwad)</option>
      <option value="tagalog_rwwad">🇵🇭 Philippines – Tagalog (Rwwad)</option>
      <option value="portuguese_nasr">🇧🇷🇵🇹 Portugal/Brazil – Portuguese (Nasr)</option>
      <option value="romanian_project">🇷🇴 Romania – Romanian (Project)</option>
      <option value="kinyarwanda_assoc">🇷🇼 Rwanda – Kinyarwanda (Assoc)</option>
      <option value="serbian_rwwad">🇷🇸 Serbia – Serbian (Rwwad)</option>
      <option value="sinhalese_mahir">🇱🇰 Sri Lanka – Sinhalese (Mahir)</option>
      <option value="tamil_omar">🇮🇳🇱🇰 Sri Lanka/India – Tamil (Omar)</option>
      <option value="somali_yacob">🇸🇴 Somalia – Somali (Yacob)</option>
      <option value="spanish_montada_eu">🇪🇸 Spanish</option>
      <option value="spanish_montada_latin">🇪🇸 Latin America – Spanish (Montada Latin)</option>
      <option value="swahili_barawani">🇹🇿 Tanzania – Swahili (Barawani)</option>
      <option value="tajik_arifi">🇹🇯 Tajikistan – Tajik (Arifi)</option>
      <option value="turkish_rwwad">🇹🇷 Turkey – Turkish (Rwwad)</option>
      <option value="urdu_junagarhi">🇮🇳🇵🇰 India/Pakistan – Urdu (Junagarhi)</option>
      <option value="uyghur_saleh">🇨🇳 Uyghur (Saleh)</option>
      <option value="uzbek_rwwad">🇺🇿 Uzbekistan – Uzbek (Rwwad)</option>
      <option value="vietnamese_rwwad">🇻🇳 Vietnam – Vietnamese (Rwwad)</option>
      </select>

    <!-- 🔤 Input Kata -->
    <input type="text" id="kataInput" placeholder="Cari kata di Quran..." style="width: 100%; margin-bottom: 10px;">

    <!-- 🚀 Tombol Mulai Search -->
    <button id="mulaiSearchBtn" style="width: 100%;">Mulai Search</button>

    <div id="loadingIndicator" style="display:none; text-align:center; margin:10px 0; color:#007bff; font-weight:bold;">
    ⏳ Memuat...
    </div>

    <!-- 📋 Hasil Pencarian -->
    <div id="searchResults" style="margin-top: 15px; max-height: 300px; overflow-y: auto;"></div>
  </div>
</div>



<div class="button-wrapper">
  <button onclick="setVersion('v1')">Quran V1</button>
</div>
<div class="button-wrapper">
  <button onclick="setVersion('v2')">Quran V2</button>
</div>
</div>


<div id="pages"></div>

<div class="controls">


  <label>
  Opacity Gambar:
  <input type="range" id="backgroundOpacity" min="0" max="100" value="100">
</label>

  <!-- Ukuran Font Ayat -->
<label>
  Ukuran Ayat:
  <input type="range" id="quranFontSize" min="18" max="72" value="36">
</label>
  
<label>
  Ukuran Terjemah:
  <input type="range" id="translationFontSize" min="10" max="48" value="20">
</label>

<!-- Ukuran Font Info Surah -->
<label>
  Ukuran Info Surah:
  <input type="range" id="infoFontSize" min="10" max="32" value="16">
</label>

  <!-- Jarak Kata Quran -->
<label>
  Jarak Kata Quran:
  <input type="range" id="quranWordSpacing" min="0" max="1" step="0.05" value="0.1">
</label>

<!-- Jarak Kata Terjemah -->
<label>
  Jarak Kata Terjemah:
  <input type="range" id="translationWordSpacing" min="0" max="1" step="0.05" value="0.2">
</label>


<!-- Pilihan Font Terjemah -->
<div class="button-wrapper">
  <button id="showFontSelectBtn" class="button" type="button">Font Terjemah</button>
</div>
  <div id="fontSelectWrapper" style="display: none; flex-direction: column; gap: 0.5em; margin-top: 0.5em;">
  <select id="translationFontSelect">
    <option value="https://raw.githubusercontent.com/githubnext/monaspace/main/fonts/webfonts/MonaspaceNeon-BoldItalic.woff2">Monaspace Neon</option>
    <option value="https://raw.githubusercontent.com/videomurottal/poster/main/fonts/Anton-Regular.ttf">Anton</option>
    <option value="https://raw.githubusercontent.com/videomurottal/poster/main/fonts/BebasNeue-Regular.ttf">Bebas Neue</option>
    <option value="https://raw.githubusercontent.com/videomurottal/poster/main/fonts/Castoro-Regular.ttf">Castoro</option>
  </select>
  <button id="applyFontBtn" class="button" type="button">Terapkan</button>
</div>


     <!-- Pilih Wallpaper -->
  <label><select id="backgroundSelect">
      <option value="https://images.pexels.com/photos/6068385/pexels-photo-6068385.jpeg">Wallpaper 1</option>
      <option value="https://images.pexels.com/photos/673020/pexels-photo-673020.jpeg">Wallpaper 2</option>
    <option value="https://images.pexels.com/photos/10257141/pexels-photo-10257141.jpeg">Wallpaper 3</option>
    <option value="https://images.pexels.com/photos/13922651/pexels-photo-13922651.jpeg">Wallpaper 4</option>
    </select>
  </label>


  
  
<!-- 🎨 Warna Elemen -->
<div class="button-wrapper">
  <button id="toggleColorPanel" class="button" type="button">Warna Elemen</button>
</div>

<div id="colorPanel" style="display: none; flex-direction: column; gap: 0.5em; margin-top: 0.5em;">
  <label for="colorTargetSelect">Pilih Target Warna:</label>
  <select id="colorTargetSelect">
    <option value="quran-text">Warna Ayat</option>
    <option value="translation">Warna Terjemah</option>
    <option value="surah-info">Warna Info Surah</option>
  </select>
  <label for="colorPicker">Pilih Warna:</label>
  <input type="color" id="colorPicker" value="#e83fb0">
</div>




 <!-- 🎨 Warna Background -->
<div class="button-wrapper">
  <button id="toggleBackgroundPicker" class="button" type="button">Warna Background</button>
</div>
<div id="backgroundPickerPanel" style="display: none; margin-top: 0.5em;">
  <input type="color" id="backgroundColorPicker" value="#23eb55">
</div>
  
    <div class="button-wrapper">
  <button id="saveImageTrigger">Download Poster</button>
</div>

  <div class="button-wrapper">
  <button id="pexelsButton">Cari Background</button>
</div>

  <!-- Upload File -->
  <div class="button-wrapper">
  <button id="uploadTrigger">Upload Background</button>
  <input type="file" id="backgroundUpload" accept="image/*" style="display: none;">
</div>

  <!-- Input URL di awal -->
  <div class="button-wrapper">
  <button id="showUrlInput" class="button">Link Background</button>
</div>

<div id="urlInputWrapper" style="display:none; flex-direction: column; gap: 0.5em;">
  <label>
    <input type="url" id="backgroundUrl" placeholder="Masukkan https://" style="width: 100%;">
  </label>
  <button id="applyUrlButton" class="button">OK</button>
</div>


  <button id="installPWAButton" class="button install-pwa">
  Instal Poster
</button>

  
</div>

<!-- 📸 Modal Pexels -->
<div id="pexelsModal" class="modal-overlay" style="display: none;">
  <div class="modal-content">
    <button class="pexels-close">❌</button>
    <h3>Cari Gambar dari Pexels</h3>

    <!-- 🔤 Input Kata Kunci -->
    <input type="text" id="pexelsKeyword" placeholder="Masukkan kata kunci gambar..." style="width: 100%; margin-bottom: 10px;">

    <!-- 🚀 Tombol Terapkan -->
    <button id="applyPexelsBtn" style="width: 100%;">Cari Background</button>

    <!-- 📋 Preview Gambar -->
    <div id="pexelsPreview" style="margin-top: 15px; max-height: 300px; overflow-y: auto; display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 8px;"></div>
  </div>
</div>
  
<!-- 🔥 Loader Overlay -->
<div id="loaderOverlay" style="
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(255,255,255,0.8);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 9999;
  display: none;">
  <div style="
    border: 8px solid #f3f3f3;
    border-top: 8px solid #4cafef;
    border-radius: 50%;
    width: 60px;
    height: 60px;
    animation: spin 1s linear infinite;">
  </div>
</div>

<style>
@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
</style>

<script>

const backgroundSelect = document.getElementById("backgroundSelect");
const backgroundUpload = document.getElementById("backgroundUpload");
const backgroundUrl = document.getElementById("backgroundUrl");
const pagesContainer = document.getElementById("pages");



// Dropdown Gambar
backgroundSelect.addEventListener("change", () => {
  const bg = backgroundSelect.value;
  if (bg) {
    pagesContainer.style.setProperty('--bg-image', `url('${bg}')`);
    backgroundUrl.value = "";
  } else {
    pagesContainer.style.setProperty('--bg-image', 'none');
  }
  saveHistory();
});

// Upload Gambar
backgroundUpload.addEventListener("change", () => {
  const file = backgroundUpload.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = function (e) {
      pagesContainer.style.setProperty('--bg-image', `url('${e.target.result}')`);
      backgroundSelect.value = "";
      backgroundUrl.value = "";
    };
    reader.readAsDataURL(file);
  }
});

// Gambar dari URL (tekan Enter)
backgroundUrl.addEventListener("keydown", (e) => {
  if (e.key === "Enter") {
    const url = backgroundUrl.value.trim();
    if (url) {
      pagesContainer.style.setProperty('--bg-image', `url('${url}')`);
      backgroundSelect.value = "";
      saveHistory();
    }
  }
});




  
  
function saveHistory() {
  const history = {
    surah: surahSelect.value,
    ayah: ayahSelect.value,
    wordStart: wordStart.value,
    wordEnd: wordEnd.value,
    translation: wordTranslationId.value,
    background: backgroundSelect.value,
    version: currentVersion
  };
  localStorage.setItem('quranHistory', JSON.stringify(history));
}

function loadHistory() {
  const history = JSON.parse(localStorage.getItem('quranHistory') || '{}');

  if (history.surah) surahSelect.value = history.surah;
  if (history.version) currentVersion = history.version;

  // ✅ Default wallpaper jika belum ada data background
  const defaultBg = "https://images.pexels.com/photos/673020/pexels-photo-673020.jpeg";
  const bgToUse = history.background || defaultBg;

  backgroundSelect.value = bgToUse;
  pagesContainer.style.setProperty('--bg-image', `url('${bgToUse}')`);

  return history;
}

const loaderOverlay = document.getElementById('loaderOverlay');
function showLoader() { loaderOverlay.style.display = 'flex'; }
function hideLoader() { loaderOverlay.style.display = 'none'; }

const translationLanguageMap = { "20": "en", "33": "id" };

const surahList = {
  1:["Al-Fātiḥah"], 2:["Al-Baqarah"], 3:["Āl ʿImrān"], 4:["An-Nisāʾ"],
  5:["Al-Māʾidah"], 6:["Al-Anʿām"], 7:["Al-Aʿrāf"], 8:["Al-Anfāl"],
  9:["At-Tawbah"], 10:["Yūnus"], 11:["Hūd"], 12:["Yūsuf"], 13:["Ar-Raʿd"],
  14:["Ibrāhīm"], 15:["Al-Ḥijr"], 16:["An-Naḥl"], 17:["Al-Isrāʾ"],
  18:["Al-Kahf"], 19:["Maryam"], 20:["Ṭā-Hā"], 21:["Al-Anbiyāʾ"],
  22:["Al-Ḥajj"], 23:["Al-Muʾminūn"], 24:["An-Nūr"], 25:["Al-Furqān"],
  26:["Ash-Shuʿarāʾ"], 27:["An-Naml"], 28:["Al-Qaṣaṣ"], 29:["Al-ʿAnkabūt"],
  30:["Ar-Rūm"], 31:["Luqmān"], 32:["As-Sajdah"], 33:["Al-Aḥzāb"],
  34:["Sabaʾ"], 35:["Fāṭir"], 36:["Yā-Sīn"], 37:["As-Ṣāffāt"],
  38:["Ṣād"], 39:["Az-Zumar"], 40:["Ghāfir"], 41:["Fuṣṣilat"], 42:["Ash-Shūrā"],
  43:["Az-Zukhruf"], 44:["Ad-Dukhān"], 45:["Al-Jāthiyah"], 46:["Al-Aḥqāf"],
  47:["Muḥammad"], 48:["Al-Fatḥ"], 49:["Al-Ḥujurāt"], 50:["Qāf"],
  51:["Adh-Dhāriyāt"], 52:["Aṭ-Ṭūr"], 53:["An-Najm"], 54:["Al-Qamar"],
  55:["Ar-Raḥmān"], 56:["Al-Wāqiʿah"], 57:["Al-Ḥadīd"], 58:["Al-Mujādilah"],
  59:["Al-Ḥashr"], 60:["Al-Mumtaḥanah"], 61:["Aṣ-Ṣaff"], 62:["Al-Jumuʿah"],
  63:["Al-Munāfiqūn"], 64:["At-Taghābun"], 65:["Aṭ-Ṭalāq"], 66:["At-Taḥrīm"],
  67:["Al-Mulk"], 68:["Al-Qalam"], 69:["Al-Ḥāqqah"], 70:["Al-Maʿārij"],
  71:["Nūḥ"], 72:["Al-Jinn"], 73:["Al-Muzzammil"], 74:["Al-Muddaththir"],
  75:["Al-Qiyāmah"], 76:["Al-Insān"], 77:["Al-Mursalāt"], 78:["An-Nabaʾ"],
  79:["An-Nāziʿāt"], 80:["ʿAbasa"], 81:["At-Takwīr"], 82:["Al-Infiṭār"],
  83:["Al-Muṭaffifīn"], 84:["Al-Inshiqāq"], 85:["Al-Burūj"], 86:["Aṭ-Ṭāriq"],
  87:["Al-Aʿlā"], 88:["Al-Ghāshiyah"], 89:["Al-Fajr"], 90:["Al-Balad"],
  91:["Ash-Shams"], 92:["Al-Layl"], 93:["Aḍ-Ḍuḥā"], 94:["Ash-Sharḥ"],
  95:["At-Tīn"], 96:["Al-ʿAlaq"], 97:["Al-Qadr"], 98:["Al-Bayyinah"],
  99:["Az-Zalzalah"], 100:["Al-ʿĀdiyāt"], 101:["Al-Qāriʿah"], 102:["At-Takāthur"],
  103:["Al-ʿAṣr"], 104:["Al-Humazah"], 105:["Al-Fīl"], 106:["Quraysh"],
  107:["Al-Māʿūn"], 108:["Al-Kawthar"], 109:["Al-Kāfirūn"], 110:["An-Naṣr"],
  111:["Al-Masad"], 112:["Al-Ikhlāṣ"], 113:["Al-Falaq"], 114:["An-Nās"]
};

const surahSelect = document.getElementById("surahSelect");
const ayahSelect = document.getElementById("ayahSelect");
const wordStart = document.getElementById("wordStart");
const wordEnd = document.getElementById("wordEnd");
const wordTranslationId = document.getElementById("wordTranslationId");
let currentVersion = 'v1';
let words = [];
let initialLoad = true;

function setVersion(v) {
  currentVersion = v;
  loadAyat();
}

for (let i in surahList) {
  const [name] = surahList[i];
  surahSelect.appendChild(new Option(`${i}. ${name}`, i));
}

surahSelect.addEventListener("change", () => { updateAyahDropdown(); saveHistory(); });
ayahSelect.addEventListener("change", () => { loadAyat(); saveHistory(); });
wordStart.addEventListener("change", () => {
  const startVal = +wordStart.value;
  wordEnd.innerHTML = "";
  for (let i = startVal; i <= words.length; i++) wordEnd.appendChild(new Option(i, i));
  wordEnd.value = startVal;
  loadAyat();
  saveHistory();
});
wordEnd.addEventListener("change", () => { loadAyat(); saveHistory(); });
wordTranslationId.addEventListener("change", () => { loadAyat(); saveHistory(); });

async function updateAyahDropdown(callLoad = true) {
  const s = surahSelect.value
  const res = await fetch(`https://api.quran.com/api/v4/chapters/${s}`);
  const json = await res.json();
  const max = json.chapter.verses_count;
  ayahSelect.innerHTML = "";
  for (let i = 1; i <= max; i++) {
    ayahSelect.appendChild(new Option(`Ayat ${i}`, i));
  }
  ayahSelect.value = 1;

  if (callLoad) loadAyat(); // ✅ hanya dipanggil kalau diminta
}

async function loadAyat() {
  showLoader();
  try {
    const s = surahSelect.value, a = ayahSelect.value, key = `${s}:${a}`;
    const container = document.getElementById("pages");

    // 🧹 Bersihkan isi container biar tidak DOUBEL
    container.innerHTML = "";

    const pageMap = await fetch('/.netlify/functions/fetchPageMap').then(r => r.json());

    const page = pageMap[key];

    const fontName = currentVersion === 'v1'
      ? `QCF_P${String(page).padStart(3, '0')}`
      : `QCF2${String(page).padStart(3, '0')}`;

    const fontUrl = currentVersion === 'v1'
      ? `https://cdn.jsdelivr.net/gh/videomurottal/tadabbur/fonts/${fontName}.TTF`
      : `https://cdn.jsdelivr.net/gh/videomurottal/tadabbur@refs/heads/main/fontsglyphvs/${fontName}.ttf`;

    const apiField = currentVersion === "v1" ? "code_v1" : "code_v2";
    const data = await fetch(`https://api.quran.com/api/v4/verses/by_key/${key}?words=true&word_fields=${apiField}`).then(r => r.json());
    words = data.verse.words.map(w => ({ arabic: w[apiField] || w.text, id: w.id }));

    // 🔄 Update word dropdown
    const prevStart = +wordStart.value || 1, prevEnd = +wordEnd.value || 1;
    wordStart.innerHTML = "";
    for (let i = 1; i <= words.length; i++) wordStart.appendChild(new Option(`Word ${i}`, i));
    wordStart.value = initialLoad ? 1 : Math.min(prevStart, words.length);

    wordEnd.innerHTML = "";
    for (let i = wordStart.value; i <= words.length; i++) wordEnd.appendChild(new Option(`To ${i}`, i));
    wordEnd.value = initialLoad ? 1 : Math.min(prevEnd, words.length);
    initialLoad = false;

    // ✅ Inject font hanya sekali (cek jika sudah ada)
    if (!document.getElementById(`font-${fontName}`)) {
      const style = document.createElement("style");
      style.id = `font-${fontName}`;
      style.textContent = `@font-face { font-family: '${fontName}'; src: url('${fontUrl}') format('truetype'); }`;
      document.head.appendChild(style);
    }

    // 📝 Buat container ayat
    const div = document.createElement("div");
    div.className = `page-container quran-${currentVersion} quran-text`;
    div.style.fontFamily = fontName;
    container.appendChild(div);

    await document.fonts.load(`1em ${fontName}`);

    // ✨ Tampilkan kata-kata ayat
    const startIdx = (+wordStart.value || 1) - 1;
    const endIdx = (+wordEnd.value || startIdx + 1);
    const line = document.createElement("div");
    words.slice(startIdx, endIdx).forEach(word => {
      const span = document.createElement("span");
      span.className = "word";
      span.innerText = word.arabic;
      line.appendChild(span);
      line.appendChild(document.createTextNode(" "));
    });
    div.appendChild(line);

    // 🌐 Tampilkan terjemahan
    const transVal = wordTranslationId.value;
    if (transVal) {
      if (transVal.startsWith("ayah_")) {
        // 📖 Terjemahan Per-Ayat (QuranEnc)
        const transKey = transVal.replace("ayah_", "");
        try {
          const res = await fetch(`https://quranenc.com/api/v1/translation/aya/${transKey}/${s}/${a}`);
          const json = await res.json();
          const fullTranslation = json.result.translation;

          const ayahTransDiv = document.createElement("div");
          ayahTransDiv.className = "translation";
          ayahTransDiv.contentEditable = true;
          ayahTransDiv.innerText = fullTranslation;
          ayahTransDiv.style.userSelect = "text";
          ayahTransDiv.setAttribute("draggable", "false");
          div.appendChild(ayahTransDiv);
        } catch (e) {
          console.error("Gagal ambil terjemahan per-ayat:", e);
        }
      } else {
        // 📖 Terjemahan Per-Kata (Quran.com)
        const langCode = translationLanguageMap[transVal];
        try {
          const r = await fetch(`https://api.quran.com/api/v4/verses/by_key/${key}?words=true&language=${langCode}&translations=${transVal}`);
          const j = await r.json();
          const wordsData = j.verse.words;
          const wordTranslations = wordsData.map(w => w.translation?.text || "").slice(startIdx, endIdx);

          const perKataDiv = document.createElement("div");
          perKataDiv.className = "translation";
          perKataDiv.textContent = wordTranslations.join(" ");
          perKataDiv.contentEditable = true;
          perKataDiv.style.userSelect = "text";
          perKataDiv.setAttribute("draggable", "false");
          div.appendChild(perKataDiv);
        } catch (e) {
          console.error("Gagal ambil terjemah perkata:", e);
        }
      }
    }

    
    // 🖋 Atur ukuran font
    div.style.fontSize = document.getElementById("quranFontSize").value + "px";
    document.querySelectorAll(".translation").forEach(el => {
      el.style.fontSize = document.getElementById("translationFontSize").value + "px";
    });


    // 📌 Tampilkan info surah & ayat
    const surahName = surahList[s][0];
    const referenceDiv = document.createElement("div");
    referenceDiv.className = "surah-info";
    referenceDiv.textContent = `${surahName}:${a}`;
    div.appendChild(referenceDiv);
    referenceDiv.style.fontSize = document.getElementById("infoFontSize").value + "px";

    // 🏷 Tambahkan watermark
    const brandDiv = document.createElement("div");
    brandDiv.className = "brand-watermark";
    brandDiv.textContent = "by Dicky Miswardi, B.A.";
    brandDiv.contentEditable = true; // ✅ bisa diedit
    brandDiv.style.userSelect = "text";
    brandDiv.setAttribute("draggable", "false");
    container.appendChild(brandDiv);

    


    div.style.display = "block";
    requestAnimationFrame(() => div.style.opacity = "1");
  } catch (e) {
    alert("Gagal memuat ayat: " + e.message);
  } finally {
    hideLoader();
  }
}

const last = loadHistory();
updateAyahDropdown(false).then(() => {
  if (last.ayah) ayahSelect.value = last.ayah;
  if (last.wordStart) wordStart.value = last.wordStart;
  if (last.wordEnd) wordEnd.value = last.wordEnd;
  if (last.translation) wordTranslationId.value = last.translation;

  loadAyat(); // ✅ PENTING! Tampilkan ayat yang benar
});


  
</script>

<!-- Tambahkan ini di bagian <head> atau sebelum </body> -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>

<script>
  const saveImageTrigger = document.getElementById("saveImageTrigger");

  saveImageTrigger.addEventListener("click", async () => {
  const node = document.getElementById("pages");
  const s = surahSelect.value;
  const a = ayahSelect.value;
  const surahName = surahList[s][0].replace(/[^a-zA-Z0-9]/g, "-");
  const filename = `${surahName}-${a}.png`;

  // Tampilkan loader overlay
  const loader = document.getElementById("loaderOverlay");
  loader.style.display = "flex";

  try {
    const scale = 4; // 💥 4x resolusi untuk hasil tajam
    const canvas = await html2canvas(node, {
      scale: scale,
      useCORS: true,
      allowTaint: true,
      backgroundColor: null
    });

    // Konversi ke blob dengan kualitas maksimum
    canvas.toBlob(blob => {
      saveAs(blob, filename);
    }, 'image/png', 1.0);

  } catch (err) {
    alert("❌ Gagal menyimpan gambar: " + err.message);
    console.error(err);
  } finally {
    // Sembunyikan loader overlay
    loader.style.display = "none";
  }
});








    
    
    const colorTarget = document.getElementById("colorTargetSelect");
const colorPicker = document.getElementById("colorPicker");

colorPicker.addEventListener("input", () => {
  const targetClass = colorTarget.value;
  const color = colorPicker.value;
  document.querySelectorAll(`.${targetClass}`).forEach(el => {
    el.style.color = color;
  });
});

// Trigger input file saat tombol diklik
document.getElementById("uploadTrigger").addEventListener("click", function () {
  document.getElementById("backgroundUpload").click();
});

const showUrlInput = document.getElementById("showUrlInput");
const urlInputWrapper = document.getElementById("urlInputWrapper");
const applyUrlButton = document.getElementById("applyUrlButton");

showUrlInput.addEventListener("click", () => {
  const isVisible = urlInputWrapper.style.display === "flex";
  urlInputWrapper.style.display = isVisible ? "none" : "flex";
});

applyUrlButton.addEventListener("click", () => {
  const url = backgroundUrl.value.trim();
  if (url) {
    pagesContainer.style.setProperty('--bg-image', `url('${url}')`);
    backgroundSelect.value = "";
    saveHistory();
    urlInputWrapper.style.display = "none"; // ✅ Langsung tutup setelah diterapkan
  }
});


 document.getElementById("quranFontSize").addEventListener("input", e => {
   document.querySelectorAll(".quran-v1, .quran-v2").forEach(el => {
     el.style.fontSize = `${e.target.value}px`;
  });
});

document.getElementById("translationFontSize").addEventListener("input", e => {
  document.querySelectorAll(".translation").forEach(el => {
    el.style.fontSize = `${e.target.value}px`;
  });
});

document.getElementById("infoFontSize").addEventListener("input", e => {
  document.querySelectorAll(".surah-info").forEach(el => {
    el.style.fontSize = `${e.target.value}px`;
  });
});

  const backgroundColorPicker = document.getElementById("backgroundColorPicker");

backgroundColorPicker.addEventListener("input", () => {
  const color = backgroundColorPicker.value;
  pagesContainer.style.backgroundColor = color;

  // Otomatis hapus gambar background (termasuk pattern) jika ada
  pagesContainer.style.setProperty('--bg-image', 'none');
});
</script>

<script>
  // ==== Modal Open/Close ====
  const btnOpen = document.getElementById('customLinkButton');
  const btnClose = document.querySelector('.search-close');
  const modal = document.getElementById('searchModal');

  if (btnOpen && btnClose && modal) {
    btnOpen.addEventListener('click', () => {
      modal.style.display = 'flex';
    });
    btnClose.addEventListener('click', () => {
      modal.style.display = 'none';
    });
  }

  // ==== Sumber XML ====
  const xmlSources = {
    indonesian_complex: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/indonesian_complex.xml',
    quran_text: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/quran_text.xml',
    english_rwwad: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/english_rwwad.xml',
    french_rashid: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/french_rashid.xml',
    spanish_montada_eu: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/spanish_montada_eu.xml',
    pashto_rwwad: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/pashto_rwwad.xml',
    albanian_nahi: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/albanian_nahi.xml',
    azeri_musayev: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/azeri_musayev.xml',
    bosnian_rwwad: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/bosnian_rwwad.xml',
    moore_rwwad: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/moore_rwwad.xml',
    ikirundi_gehiti: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/ikirundi_gehiti.xml',
    khmer_rwwad: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/khmer_rwwad.xml',
    chinese_makin: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/chinese_makin.xml',
    lingala_zakaria: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/lingala_zakaria.xml',
    croatian_rwwad: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/croatian_rwwad.xml',
    af_ar_hamza: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/af_ar_hamza.xml',
    amharic_zain: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/amharic_zain.xml',
    oromo_ababor: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/oromo_ababor.xml',
    german_bubenheim: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/german_bubenheim.xml',
    asante_harun: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/asante_harun.xml',
    gujarati_omari: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/gujarati_omari.xml',
    hindi_omari: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/hindi_omari.xml',
    kannada_hamza: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/kannada_hamza.xml',
    malayalam_kunhi: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/malayalam_kunhi.xml',
    tamil_baqavi: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/tamil_baqavi.xml',
    telugu_muhammad: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/telugu_muhammad.xml',
    kurdish_bamoki: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/kurdish_bamoki.xml',
    persian_ih: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/persian_ih.xml',
    japanese_saeedsato: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/japanese_saeedsato.xml',
    kyrgyz_hakimov: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/kyrgyz_hakimov.xml',
    lithuanian_rwwad: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/lithuanian_rwwad.xml',
    ankobambara_dayyan: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/ankobambara_dayyan.xml',
    dutch_center: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/dutch_center.xml',
    hausa_gummi: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/hausa_gummi.xml',
    yoruba_mikail: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/yoruba_mikail.xml',
    macedonian_group: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/macedonian_group.xml',
    punjabi_arif: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/punjabi_arif.xml',
    bisayan_rwwad: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/bisayan_rwwad.xml',
    tagalog_rwwad: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/tagalog_rwwad.xml',
    portuguese_nasr: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/portuguese_nasr.xml',
    romanian_project: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/romanian_project.xml',
    kinyarwanda_assoc: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/kinyarwanda_assoc.xml',
    serbian_rwwad: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/serbian_rwwad.xml',
    sinhalese_mahir: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/sinhalese_mahir.xml',
    tamil_omar: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/tamil_omar.xml',
    somali_yacob: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/somali_yacob.xml',
    spanish_montada_latin: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/spanish_montada_latin.xml',
    swahili_barawani: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/swahili_barawani.xml',
    tajik_arifi: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/tajik_arifi.xml',
    turkish_rwwad: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/turkish_rwwad.xml',
    urdu_junagarhi: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/urdu_junagarhi.xml',
    uyghur_saleh: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/uyghur_saleh.xml',
    uzbek_rwwad: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/uzbek_rwwad.xml',
    vietnamese_rwwad: 'https://raw.githubusercontent.com/videomurottal/poster/refs/heads/main/terjemah/vietnamese_rwwad.xml'
    };

  let activeLang = localStorage.getItem('activeLang') || 'indonesian_complex';
  let activeXMLDoc = null;

  // ==== Loading Indicator ====
  function showLoading(msg = "⏳ Memuat...") {
    const loader = document.getElementById('loadingIndicator');
    if (loader) {
      loader.textContent = msg;
      loader.style.display = 'block';
    }
  }

  function hideLoading() {
    const loader = document.getElementById('loadingIndicator');
    if (loader) loader.style.display = 'none';
  }

  // ==== Muat XML sesuai pilihan ====
  async function loadSelectedXML(langKey) {
    showLoading(`⏳ Memuat terjemah: ${langKey}`);
    const parser = new DOMParser();

    try {
      // Reset XML lama
      activeXMLDoc = null;

      // Fetch fresh data (bypass cache)
      const noCacheUrl = xmlSources[langKey] + '?t=' + Date.now();
      const response = await fetch(noCacheUrl, { cache: "no-store" });

      if (!response.ok) throw new Error(`HTTP ${response.status}`);

      const text = await response.text();
      activeXMLDoc = parser.parseFromString(text, "application/xml");

      localStorage.setItem('activeLang', langKey); // hanya simpan nama bahasa aktif
      console.log(`✅ Terjemah ${langKey} dimuat`);
    } catch (err) {
      console.error(`❌ Gagal memuat ${langKey}:`, err);
      activeXMLDoc = null;
      tampilkanError("Gagal memuat terjemah.");
    } finally {
      hideLoading();
    }
  }

  // ==== Dropdown Change ====
  const translationSelect = document.getElementById('translationSelect');
  if (translationSelect) {
    translationSelect.value = activeLang; // set default
    translationSelect.addEventListener('change', (e) => {
      activeLang = e.target.value;
      loadSelectedXML(activeLang);
    });
  }

  // ==== Saat Halaman Dimuat, Load XML aktif ====
  loadSelectedXML(activeLang);

  // ==== Tombol "Mulai Search" & Enter Key ====
  const mulaiSearchBtn = document.getElementById("mulaiSearchBtn");
  const kataInput = document.getElementById("kataInput");

  function handleSearch() {
    const keyword = kataInput.value.trim().toLowerCase();
    if (!keyword) {
      tampilkanError("Kata kosong.");
      return;
    }
    if (!activeXMLDoc) {
      tampilkanError("Terjemah belum siap.");
      return;
    }

    showLoading("🔎 Mencari kata...");
    setTimeout(() => {
      searchKata(keyword);
      hideLoading();
    }, 100);
  }

  if (mulaiSearchBtn) {
    mulaiSearchBtn.addEventListener("click", debounce(handleSearch, 500));
  }

  if (kataInput) {
    kataInput.addEventListener("keypress", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        handleSearch();
      }
    });
  }

  // ==== Fungsi pencarian kata ====
  function searchKata(keyword) {
    const resultDiv = document.getElementById('searchResults');
    resultDiv.innerHTML = '';

    const suras = activeXMLDoc.getElementsByTagName('sura');
    let totalHasil = 0;

    for (let sura of suras) {
      const suraNum = sura.getAttribute('number');
      const ayas = sura.getElementsByTagName('aya');
      for (let aya of ayas) {
        const ayaNum = aya.getAttribute('number');
        const text = aya.textContent || '';
        if (text.toLowerCase().includes(keyword)) {
          const p = document.createElement('p');
          p.innerHTML = `
            Surah ${suraNum}, Ayat ${ayaNum}: ${text}
            <button onclick="goToAyat(${suraNum}, ${ayaNum})">Menuju Ayat</button>
          `;
          resultDiv.appendChild(p);
          totalHasil++;
        }
      }
    }

    if (totalHasil === 0) {
      resultDiv.innerHTML = '<p style="color:red;">Tidak ditemukan hasil untuk kata tersebut.</p>';
    }
  }

  // ==== Fungsi "Menuju ke Ayat" ====
async function goToAyat(sura, aya) {
  const surahSelect = document.getElementById('surahSelect');
  const ayahSelect = document.getElementById('ayahSelect');
  const wordTranslationId = document.getElementById('wordTranslationId');

  if (surahSelect && ayahSelect) {
    // Set Surah & trigger update Ayah dropdown
    surahSelect.value = sura;
    await updateAyahDropdown(false);

    // Set Ayah setelah dropdown Ayah selesai diisi
    ayahSelect.value = aya;

    // Sinkronkan dropdown terjemahan dengan activeLang
    if (wordTranslationId && typeof activeLang === 'string') {
      const dropdownValue = "ayah_" + activeLang; // prefix 'ayah_'
      const matchedOption = Array.from(wordTranslationId.options)
        .find(opt => opt.value === dropdownValue);

      if (matchedOption) {
        wordTranslationId.value = matchedOption.value;
      }
    }

    // 🚀 Muat ayat
    loadAyat();
  }

  // Tutup modal
  const modal = document.querySelector('.modal-overlay');
  if (modal) modal.style.display = 'none';
}




  // ==== Fungsi Error ====
  function tampilkanError(msg) {
    const resultDiv = document.getElementById('searchResults');
    resultDiv.innerHTML = `<p style="color:red;">${msg}</p>`;
  }

  // ==== Debounce Helper ====
  function debounce(fn, delay) {
    let timeout;
    return function (...args) {
      clearTimeout(timeout);
      timeout = setTimeout(() => fn.apply(this, args), delay);
    };
  }
</script>

<script>
// Word spacing untuk Quran V1 dan V2
document.getElementById("quranWordSpacing").addEventListener("input", e => {
  const spacing = `${e.target.value}em`;
  document.querySelectorAll(".quran-v1, .quran-v2").forEach(el => {
    el.style.wordSpacing = spacing;
  });
});

// Word spacing untuk terjemahan
document.getElementById("translationWordSpacing").addEventListener("input", e => {
  const spacing = `${e.target.value}em`;
  document.querySelectorAll(".translation").forEach(el => {
    el.style.wordSpacing = spacing;
  });
});


  const backgroundOpacitySlider = document.getElementById("backgroundOpacity");
backgroundOpacitySlider.addEventListener("input", () => {
  const value = backgroundOpacitySlider.value;
  const opacityValue = value / 100;
  document.querySelector("#pages::before"); // tidak bisa diakses langsung
  document.getElementById("pages").style.setProperty("--bg-opacity", opacityValue);
});

</script>


<script>
  document.addEventListener("DOMContentLoaded", () => {
    const toggleBtn = document.getElementById("showFontSelectBtn");
    const fontWrapper = document.getElementById("fontSelectWrapper");
    const fontSelect = document.getElementById("translationFontSelect");
    const applyBtn = document.getElementById("applyFontBtn");

    // Toggle tampil/sembunyi menu font
    toggleBtn.addEventListener("click", (e) => {
      e.preventDefault();
      fontWrapper.style.display = fontWrapper.style.display === "none" ? "flex" : "none";
    });

    // Fungsi memuat dan menerapkan font
    async function loadFontFromUrl(fontUrl, fontName) {
      const styleId = "dynamicFontStyle";
      const oldStyle = document.getElementById(styleId);
      if (oldStyle) oldStyle.remove();

      const style = document.createElement("style");
      style.id = styleId;
      style.textContent = `
        @font-face {
          font-family: '${fontName}';
          src: url('${fontUrl}');
        }
      `;
      document.head.appendChild(style);

      try {
        await document.fonts.load(`1em ${fontName}`);
        await document.fonts.ready;
        document.querySelectorAll(".translation").forEach(el => {
          el.style.fontFamily = `'${fontName}'`;
        });
      } catch (e) {
        console.error("Gagal memuat font:", fontName, e);
      }
    }

    // Terapkan font saat tombol diklik
    applyBtn.addEventListener("click", (e) => {
      e.preventDefault();
      const fontUrl = fontSelect.value;
      const fontName = fontSelect.options[fontSelect.selectedIndex].text.trim();

      loadFontFromUrl(fontUrl, fontName);

      // Sembunyikan menu dan hapus fokus agar tidak scroll aneh
      fontSelect.blur();
      fontWrapper.style.display = "none";
    });
  });
</script>


  <script>
  let deferredPrompt;
  const installBtn = document.getElementById("installPWAButton");

  // Sembunyikan tombol jika belum siap
  installBtn.style.display = "none";

  // Simpan event install
  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault(); // Jangan munculkan prompt otomatis
    deferredPrompt = e;
    installBtn.style.display = "inline-block"; // Tampilkan tombol
  });

  installBtn.addEventListener('click', async () => {
    if (!deferredPrompt) return;
    deferredPrompt.prompt(); // Munculkan prompt install
    const result = await deferredPrompt.userChoice;
    if (result.outcome === 'accepted') {
      console.log("✅ Pengguna setuju install");
    } else {
      console.log("❌ Pengguna batal install");
    }
    deferredPrompt = null;
    installBtn.style.display = "none"; // Sembunyikan setelah klik
  });

  window.addEventListener('appinstalled', () => {
    console.log("✅ App berhasil diinstall");
    deferredPrompt = null;
    installBtn.style.display = "none";
  });
</script>

  <script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/service-worker.js')
        .then(reg => console.log('✅ Service Worker terdaftar:', reg.scope))
        .catch(err => console.warn('❌ Service Worker gagal:', err));
    });
  }
</script>


<script>
const pexelsButton = document.getElementById("pexelsButton");
const pexelsModal = document.getElementById("pexelsModal");
const pexelsClose = document.querySelector(".pexels-close");
const applyPexelsBtn = document.getElementById("applyPexelsBtn");
const pexelsKeyword = document.getElementById("pexelsKeyword");
const pexelsPreview = document.getElementById("pexelsPreview");

pexelsButton.addEventListener("click", () => {
  pexelsModal.style.display = "flex";
  pexelsPreview.innerHTML = ""; // clear preview
  pexelsKeyword.value = "";
});

pexelsClose.addEventListener("click", () => {
  pexelsModal.style.display = "none";
});

// 🔥 Ambil gambar dari Pexels API
applyPexelsBtn.addEventListener("click", async () => {
  const query = pexelsKeyword.value.trim();
  if (!query) {
    alert("Masukkan kata kunci!");
    return;
  }

  pexelsPreview.innerHTML = "🔎 Memuat gambar...";

  try {
    const apiKey = "JWCdnIm4kz6dUqxfFCfJ0SxgpbFZ87W1j09e0bXShM1MvlFd7sZjpfxx"; // 🚨 Ganti dengan API Key Pexels kamu
    const response = await fetch(`https://api.pexels.com/v1/search?query=${encodeURIComponent(query)}&per_page=9`, {
      headers: { Authorization: apiKey }
    });
    const data = await response.json();
    pexelsPreview.innerHTML = "";

    data.photos.forEach(photo => {
      const img = document.createElement("img");
      img.src = photo.src.medium;
      img.alt = photo.photographer;
      img.style.cursor = "pointer";
      img.style.width = "100%";
      img.style.borderRadius = "8px";
      img.onclick = () => {
        pagesContainer.style.setProperty('--bg-image', `url('${photo.src.original}')`);
        backgroundSelect.value = ""; // reset dropdown
        saveHistory();
        pexelsModal.style.display = "none"; // Tutup modal
      };
      pexelsPreview.appendChild(img);
    });
  } catch (e) {
    console.error(e);
    pexelsPreview.innerHTML = "<p style='color:red;'>Gagal memuat gambar dari Pexels.</p>";
  }
});

// Fungsi yang sudah ada untuk apply background
const pexelsInput = document.getElementById("pexelsKeyword");

pexelsInput.addEventListener("keydown", function (e) {
  if (e.key === "Enter") {
    e.preventDefault(); // ⬅️ Hentikan submit form default
    document.getElementById("applyPexelsBtn").click(); // Simulasikan klik
  }
});

</script>

<script>
  document.getElementById("applyFontBtn").addEventListener("click", async () => {
  const loader = document.getElementById("loaderOverlay");
  loader.style.display = "flex"; // 🔥 Tampilkan loader

  const fontUrl = document.getElementById("translationFontSelect").value;

  try {
    // Ambil nama font dari URL untuk digunakan di CSS
    const fontName = fontUrl.split('/').pop().split('.')[0];

    // Load font secara dinamis
    const font = new FontFace(fontName, `url(${fontUrl})`);
    await font.load();
    document.fonts.add(font);

    // Terapkan font ke elemen terjemahan
    document.querySelectorAll(".translation-text").forEach(el => {
      el.style.fontFamily = fontName;
    });

  } catch (err) {
    alert("❌ Gagal memuat font: " + err.message);
    console.error(err);
  } finally {
    loader.style.display = "none"; // ✅ Sembunyikan loader
  }
});
</script>


<script>
// Toggle Warna Background
const toggleBackgroundBtn = document.getElementById("toggleBackgroundPicker");
const backgroundPickerPanel = document.getElementById("backgroundPickerPanel");

toggleBackgroundBtn.addEventListener("click", () => {
  const isVisible = backgroundPickerPanel.style.display === "flex";
  backgroundPickerPanel.style.display = isVisible ? "none" : "flex";
});

// Toggle Warna Elemen
const toggleColorBtn = document.getElementById("toggleColorPanel");
const colorPanel = document.getElementById("colorPanel");

toggleColorBtn.addEventListener("click", () => {
  const isVisible = colorPanel.style.display === "flex";
  colorPanel.style.display = isVisible ? "none" : "flex";
});
</script>

</body>
</html>
